<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Schedule!</title>
  <link rel="preconnect" href="https://fonts.gstatic.com">
  <link href="https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400&display=swap" rel="stylesheet">
  <link rel="icon" type="image/png" href="3.ico">
    <style>


body {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: flex-start;
  font-size: 12px;
  min-height: 100vh;
  margin: 0;
  padding-top: 20px;
  background: #303030 url('blur1.jpg') no-repeat center top;
  background-size: cover;
  font-family: 'Poppins', sans-serif;
  overflow-x: hidden;
  }

  .instructor-info-container {
  position: absolute;
  top: 20px;
  left: 20px;
  width: 200px; /* Adjust as needed */
  padding: 10px;
  background-color: rgba(255, 255, 255, 0.1);
  border-radius: 0px;
  box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
  color: rgb(120, 120, 120);
  text-align: center;
  z-index: 2;
 }

 .instructor-info-container img {
  width: 100%;
  border-radius: 8px;
  margin-bottom: 10px;
 }

 .instructor-info-container p {
  margin-bottom: 0;
  text-align: center;
 }

 /* Homework Container (Top Right) */
 .homework-container {
  position: absolute;
  top: 20px;
  right: 20px;
  width: 150px; /* Adjust as needed */
  padding: 10px;
  background-color: rgba(255, 255, 255, 0.1);
  border-radius: 10px;
  box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
  color: rgb(255, 0, 0);
  text-align: center;
  z-index: 2;
 }

 .homework-container h3 {
  margin-top: 0;
 }

 /* Mobile View Adjustments - Hide if screen width is small */
 @media (max-width: 650px) { /* Adjust breakpoint as needed */
  .instructor-info-container,
  .homework-container {
  display: none;
  }
 }


  .user-info {
  margin: 20px 0;
  width: 420px;
 }

  .links-outer-container {
  display: flex;
  gap: 10px;
  margin-bottom: 10px;
 }

  .links-container {
  flex: 1;
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 10px;
  padding: 15px;
 }

  .container {
  position: relative;
  width: 420px;
  max-height: 80vh;
  backdrop-filter: blur(10px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 15px;
  box-shadow: 0 0 20px rgba(0, 0, 0, 0.3);
  padding: 20px;
  color: rgb(0, 0, 0);
  text-align: center;
  overflow: hidden;
  z-index: 1;
  margin-bottom: 10px;
  box-sizing: border-box;
 }

 .contshad{
  position: relative;
  width: 420px;
  max-height: 80vh;
  /* backdrop-filter: blur(5px); */
  /* background-color: rgb(0, 0, 0); */
  border: 2px solid rgba(175, 175, 175, 0.2);
  border-radius: 15px;
  box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
  padding: 20px;
  color: rgb(0, 0, 0);
  text-align: center;
  overflow: hidden;
  z-index: 1;
  margin-bottom: 10px;
  box-sizing: border-box;

 }

  .schedule-container {
  width: 420px;
  backdrop-filter: blur(10px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 15px;
  box-shadow: 0 0 20px rgba(0, 0, 0, 0.3);
  padding: 20px;
  color: rgb(34, 34, 34);
  /* margin-top: 20px; */
  /* margin-bottom: 20px; */
  text-align: left;
 }

  .paragraph {
  color: rgb(110, 110, 110);
  text-align: center;
 }

  .link-title {
  font-size: 1.1em;
  margin-bottom: 5px;
 }

  a {
  font-size: 1em;
  color: #6a9eff;
  text-decoration: none;
 }

  a:hover {
  color: lightgrey;
 }

  a:visited {
  color:  #8a37ff;;
 }

  .schedule-container h3 {
  text-align: center;
  margin-bottom: 10px;
 }

  .schedule-table {
  width: 100%;
  border-collapse: collapse;
  
 }

  .schedule-table th,
  .schedule-table td {
  padding: 8px;
  border-bottom: 1px solid rgba(255, 255, 255, 0.1);
  text-align: left;
  text-align: center;
 }

  .schedule-table th {
  font-weight: bold;
  text-align: center;
 }

  .schedule-table tr:last-child td {
  border-bottom: none;
 }

  /* Mobile View Adjustments */
  @media (max-width: 600px) {
  .instructor-info-container,
  .homework-container {
  display: none; /* Hide on smaller screens */
  }
  }
  </style>
</head>



<body>
<!--   
  <div class="instructor-info-container">
    <img src="kk.png" alt="Instructor Photo">
        <p> <code>rohitmandal814566@gmail.com</code> </p>     
  </div>

  
   -->

    <div id="user-info">

        <div class="container links-outer-container">
            <div id="class-link-container" class="contshad">
                <h3 class="link-title">Class Links</h3>
                <p><a id="class-link" href="#" target="_blank">GoogleMeet</a></p>
            </div>
            <div id="notes-link-container" class="contshad">
                <h3 class="link-title">Notes</h3>
                <p><a id="notes-link" href="#" target="_blank">GoodNotes</a></p>
            </div>
        </div>
      
         
        <div class="container links-outer-container">
            <div id="class-link-container" class="contshad">
                <h3>Next Class</h3>
                <p><span id=""></span> at <span id="next-class-time"></span></p>
            </div>

            <div id="notes-link-container" class="contshad">
                <h3>Time Remaining</h3>
                <p class="countdown"><span id="days"></span>d <span id="hours"></span>h <span id="minutes"></span>m <span id="seconds"></span>s</p>
            </div>
        </div>

        <div id="user-not-found" class="container" style="display: none;">
            <p>User not found or invalid email parameter.</p>
        </div>
        
    </div>



    <div id="schedule-display" class="container schedule-container" style="display: none;">
        <h3>Your Weekly Schedule (Local Time)</h3>
        <div id="weekly-schedule">
            <table class="schedule-table">
                <thead>
                    <tr>
                        <th>Day</th>
                        <th>Time</th>
                    </tr>
                </thead>
                <tbody id="schedule-body">
                    </tbody>
            </table>
        </div>   
    </div>


    <div class="container"> rohitmandal814566@gmail.com</div>



    <script>
        // Schedule data stored in UTC
        const schedule = {
            "alvina": {
                classLink: "https://meet.google.com/xdz-xaob-rdk",
                notesLink: "https://share.goodnotes.com/s/vqohuFAlaY5veLJBnno7ri",
                weeklyScheduleUTC: [
                    { day: "Monday", time: "08:30" },
                    { day: "Tuesday", time: "08:30" },
                    { day: "Wednesday", time: "08:30" },
                    { day: "Wednesday", time: "08:30" }
                ]
            },
            "noah": {
                classLink: "https://meet.google.com/xdz-xaob-rdk",
                notesLink: "https://share.goodnotes.com/s/vNOc9PcD0tjjHPh0mX4mj0",
                weeklyScheduleUTC: [
                    { day: "Monday", time: "17:00" },
                    { day: "Saturday", time: "17:00" }
                ]
            },
            "eza": {
                classLink: "https://meet.google.com/xdz-xaob-rdk",
                notesLink: "https://share.goodnotes.com/s/nJJajqlCWm5j67RTF3M8H5",
                weeklyScheduleUTC: [
                    { day: "Wednesday", time: "15:00" },
                    { day: "Saturday", time: "16:00" }
                ]
            },
            "mariana": {
                classLink: "https://meet.google.com/xdz-xaob-rdk",
                notesLink: "https://share.goodnotes.com/s/9DDo4h7apdA8UwlznhlmcA",
                weeklyScheduleUTC: [
                    { day: "Thursday", time: "17:00" },
                    { day: "Saturday", time: "09:00" }
                ]
            },
            "rohitmandal814566@gmail.com": {
                classLink: "https://meet.google.com/your-class-link",
                notesLink: "https://share.goodnotes.com/your-notes-link",
                weeklyScheduleUTC: [
                    { day: "Thursday", time: "17:00" }, // Thursday 5:00 PM UTC
                    { day: "Saturday", time: "09:00" }  // Saturday 9:00 AM UTC
                ]
            }
        };

        // Function to calculate time remaining until the next class (based on UTC schedule)
        function calculateTimeRemaining(schedule) {
            const nowLocal = new Date();
            const viewerTimeZone = Intl.DateTimeFormat().resolvedOptions().timeZone;

            let closestClassTimeUTC = null;
            let closestClassSchedule = null;

            for (const classSchedule of schedule.weeklyScheduleUTC) {
                const classDay = classSchedule.day;
                const classTime = classSchedule.time;

                const nextClassUTC = getNextClassDateTimeUTC(classDay, classTime, nowLocal); // Pass nowLocal

                if (nextClassUTC > nowLocal.getTime()) {
                    if (!closestClassTimeUTC || nextClassUTC < closestClassTimeUTC) {
                        closestClassTimeUTC = nextClassUTC;
                        closestClassSchedule = classSchedule;
                    }
                }
            }

            if (!closestClassSchedule) return null;

            const timeDiff = closestClassTimeUTC - nowLocal.getTime(); // Difference between future UTC and current local
            const days = Math.floor(timeDiff / (1000 * 60 * 60 * 24));
            const hours = Math.floor((timeDiff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((timeDiff % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((timeDiff % (1000 * 60)) / 1000);

            // Convert the next class UTC time to the viewer's local time for display
            const closestClassTimeViewerLocal = new Date(closestClassTimeUTC);

            return { days, hours, minutes, seconds, closestClassSchedule, closestClassTimeViewerLocal };
        }

        // Function to get the next class UTC timestamp
        function getNextClassDateTimeUTC(day, time, nowLocal) {
            const dayNames = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"];
            const targetDayIndex = dayNames.indexOf(day);
            const currentDayIndexUTC = nowLocal.getUTCDay(); // Use getUTCDay for UTC day

            let daysUntilClass = targetDayIndex - currentDayIndexUTC;
            if (daysUntilClass < 0) {
                daysUntilClass += 7;
            } else if (daysUntilClass === 0) {
                const [hours, minutes] = time.split(':').map(Number);
                const currentUTCHours = nowLocal.getUTCHours();
                const currentUTCMinutes = nowLocal.getUTCMinutes();

                if (hours < currentUTCHours || (hours === currentUTCHours && minutes <= currentUTCMinutes)) {
                    daysUntilClass += 7;
                }
            }

            const nextClassUTCDate = new Date(Date.UTC(
                nowLocal.getUTCFullYear(),
                nowLocal.getUTCMonth(),
                nowLocal.getUTCDate() + daysUntilClass,
                parseInt(time.split(':')[0], 10),
                parseInt(time.split(':')[1], 10),
                0,
                0
            ));

            return nextClassUTCDate.getTime();
        }

        // Function to display countdown and update every second
        function updateCountdownForUser(email, userSchedule) {
            const userInfoDiv = document.getElementById("user-info");
            const scheduleDisplayDiv = document.getElementById("schedule-display");
            const scheduleBody = document.getElementById("schedule-body");

            const linksOuterContainer = document.createElement("div");
            linksOuterContainer.classList.add("container", "links-outer-container");
            const classLinkContainer = document.createElement("div");
            classLinkContainer.classList.add("contshad");
            const notesLinkContainer = document.createElement("div");
            notesLinkContainer.classList.add("contshad");
            const nextClassOuterContainer = document.createElement("div"); // New outer container for Next Class
            nextClassOuterContainer.classList.add("container", "links-outer-container");
            const nextClassContainer = document.createElement("div");
            nextClassContainer.classList.add("contshad");
            const timeRemainingContainer = document.createElement("div");
            timeRemainingContainer.classList.add("contshad");

            function refreshCountdown() {
                const timeRemainingData = calculateTimeRemaining(userSchedule);

                linksOuterContainer.innerHTML = '';
                classLinkContainer.innerHTML = '';
                notesLinkContainer.innerHTML = '';
                nextClassContainer.innerHTML = '';
                timeRemainingContainer.innerHTML = '';
                nextClassOuterContainer.innerHTML = ''; // Clear the outer container as well

                if (timeRemainingData) {
                    const { days, hours, minutes, seconds, closestClassSchedule, closestClassTimeViewerLocal } = timeRemainingData;

                    classLinkContainer.innerHTML = `
                        <h3 class="link-title">Class Links</h3>
                        <p><a href="${userSchedule.classLink}" target="_blank">Join Class</a></p>
                    `;

                    notesLinkContainer.innerHTML = `
                        <h3 class="link-title">Notes</h3>
                        <p><a href="${userSchedule.notesLink}" target="_blank">View Notes</a></p>
                    `;

                    linksOuterContainer.appendChild(classLinkContainer);
                    linksOuterContainer.appendChild(notesLinkContainer);

                    // Format the next class time in the viewer's local timezone
                    const nextClassDayLocal = closestClassTimeViewerLocal.toLocaleDateString('en-US', { weekday: 'long' });
                    const nextClassTimeLocal = closestClassTimeViewerLocal.toLocaleTimeString(undefined, { hour: '2-digit', minute: '2-digit' });

                    nextClassContainer.innerHTML = `
                        <h3>Next Class</h3>
                        <p><span id="next-class-day">${nextClassDayLocal}</span> at <span id="next-class-time">${nextClassTimeLocal}</span></p>
                    `;

                    timeRemainingContainer.innerHTML = `
                        <h3>Time Remaining</h3>
                        <p class="countdown"><span id="days">${days}</span>d <span id="hours">${hours}</span>h <span id="minutes">${minutes}</span>m <span id="seconds">${seconds}</span>s</p>
                    `;

                    nextClassOuterContainer.appendChild(nextClassContainer);
                    nextClassOuterContainer.appendChild(timeRemainingContainer);

                    const totalSecondsRemaining = (days * 24 * 3600) + (hours * 3600) + (minutes * 60) + seconds;

                    // Removed the auto-open logic as per your request in previous turn.

                } else {
                    nextClassContainer.innerHTML = `<h3>Next Class</h3><p>No upcoming class found.</p>`;
                    timeRemainingContainer.innerHTML = `<h3>Time Remaining</h3><p>--</p>`;
                    nextClassOuterContainer.appendChild(nextClassContainer);
                    nextClassOuterContainer.appendChild(timeRemainingContainer);
                }

                userInfoDiv.innerHTML = '';
                userInfoDiv.appendChild(linksOuterContainer);
                userInfoDiv.appendChild(nextClassOuterContainer); // Append the outer container

                // Update the schedule display
                scheduleDisplayDiv.style.display = 'block';
                scheduleBody.innerHTML = ''; // Clear previous schedule

                const dayNames = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"];
                const nowLocal = new Date();
                const currentDayIndexLocal = nowLocal.getDay(); // Get local day index (0-6)

                userSchedule.weeklyScheduleUTC.forEach(item => {
                    const row = scheduleBody.insertRow();
                    const dayCell = row.insertCell();
                    const timeCell = row.insertCell();

                    const targetDayIndexUTC = dayNames.indexOf(item.day);

                    // Calculate the date of the next occurrence of this class in UTC
                    const [hoursUTC, minutesUTC] = item.time.split(':').map(Number);
                    const nextClassUTCDate = new Date(Date.UTC(
                        nowLocal.getUTCFullYear(),
                        nowLocal.getUTCMonth(),
                        nowLocal.getUTCDate() + (targetDayIndexUTC - nowLocal.getUTCDay() + 7) % 7,
                        hoursUTC,
                        minutesUTC,
                        0,
                        0
                    ));

                    // Convert UTC time to local time for display
                    const localDay = nextClassUTCDate.toLocaleDateString('en-US', { weekday: 'long' });
                    const localTime = nextClassUTCDate.toLocaleTimeString(undefined, { hour: '2-digit', minute: '2-digit' });

                    dayCell.textContent = localDay;
                    timeCell.textContent = localTime;
                });
            }

            refreshCountdown();
            setInterval(refreshCountdown, 1000);
        }

        function getEmailFromURL() {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get('email');
        }

        const email = getEmailFromURL();
        if (email && schedule[email]) {
            updateCountdownForUser(email, schedule[email]);
        } else {
            document.getElementById("user-info").style.display = 'none';
            document.getElementById("schedule-display").style.display = 'none';
            document.getElementById("user-not-found").style.display = 'block';
        }
    </script>
</body>
</html>
