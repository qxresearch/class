<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Class Schedule</title>
    <style>


body {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: flex-start;
  font-size: 12px;
  min-height: 100vh;
  margin: 0;
  padding-top: 20px;
  background: #303030 url('blur1.jpg') no-repeat center top;
  background-size: cover;
  font-family: 'Poppins', sans-serif;
  overflow-x: hidden;
  }

  .instructor-info-container {
  position: absolute;
  top: 20px;
  left: 20px;
  width: 200px; /* Adjust as needed */
  padding: 10px;
  background-color: rgba(255, 255, 255, 0.1);
  border-radius: 0px;
  box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
  color: rgb(120, 120, 120);
  text-align: center;
  z-index: 2;
 }

 .instructor-info-container img {
  width: 100%;
  border-radius: 8px;
  margin-bottom: 10px;
 }

 .instructor-info-container p {
  margin-bottom: 0;
  text-align: center;
 }

 /* Homework Container (Top Right) */
 .homework-container {
  position: absolute;
  top: 20px;
  right: 20px;
  width: 150px; /* Adjust as needed */
  padding: 10px;
  background-color: rgba(255, 255, 255, 0.1);
  border-radius: 10px;
  box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
  color: rgb(255, 0, 0);
  text-align: center;
  z-index: 2;
 }

 .homework-container h3 {
  margin-top: 0;
 }

 /* Mobile View Adjustments - Hide if screen width is small */
 @media (max-width: 650px) { /* Adjust breakpoint as needed */
  .instructor-info-container,
  .homework-container {
  display: none;
  }
 }


  .user-info {
  margin: 20px 0;
  width: 420px;
 }

  .links-outer-container {
  display: flex;
  gap: 10px;
  margin-bottom: 10px;
 }

  .links-container {
  flex: 1;
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 10px;
  padding: 15px;
 }

  .container {
  position: relative;
  width: 420px;
  max-height: 80vh;
  backdrop-filter: blur(10px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 15px;
  box-shadow: 0 0 20px rgba(0, 0, 0, 0.3);
  padding: 20px;
  color: rgb(0, 0, 0);
  text-align: center;
  overflow: hidden;
  z-index: 1;
  margin-bottom: 10px;
  box-sizing: border-box;
 }

  .schedule-container {
  width: 420px;
  backdrop-filter: blur(10px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 15px;
  box-shadow: 0 0 20px rgba(0, 0, 0, 0.3);
  padding: 20px;
  color: rgb(34, 34, 34);
  margin-top: 20px;
  margin-bottom: 20px;
  text-align: left;
 }

  .paragraph {
  color: rgb(110, 110, 110);
  text-align: center;
 }

  .link-title {
  font-size: 1.1em;
  margin-bottom: 5px;
 }

  a {
  font-size: 1em;
  color: #a5c4ff;
  text-decoration: none;
 }

  a:hover {
  color: lightgrey;
 }

  a:visited {
  color: white;
 }

  .schedule-container h3 {
  text-align: center;
  margin-bottom: 10px;
 }

  .schedule-table {
  width: 100%;
  border-collapse: collapse;
  
 }

  .schedule-table th,
  .schedule-table td {
  padding: 8px;
  border-bottom: 1px solid rgba(255, 255, 255, 0.1);
  text-align: left;
  text-align: center;
 }

  .schedule-table th {
  font-weight: bold;
  text-align: center;
 }

  .schedule-table tr:last-child td {
  border-bottom: none;
 }

  /* Mobile View Adjustments */
  @media (max-width: 600px) {
  .instructor-info-container,
  .homework-container {
  display: none; /* Hide on smaller screens */
  }

  /* Option 2: Move to the end of the page on mobile */
  /*
  .instructor-info-container,
  .homework-container {
  position: relative; !* Remove absolute positioning *!
  top: auto;
  left: auto;
  right: auto;
  margin: 20px auto; !* Center and add margin *!
  width: 90%; !* Take up more width on mobile *!
  }
  */
  }


    </style>
</head>
<body>
<!--   
  <div class="instructor-info-container">
    <img src="kk.png" alt="Instructor Photo">
        <p> <code>rohitmandal814566@gmail.com</code> </p>     
  </div>

  
   -->
  

    <div id="user-info">

        <div class="container links-outer-container">
            <div id="class-link-container" class="container links-container">
                <h3 class="link-title">Class Links</h3>
                <p><a id="class-link" href="#" target="_blank">GoogleMeet</a></p>
            </div>
            <div id="notes-link-container" class="container links-container">
                <h3 class="link-title">Notes</h3>
                <p><a id="notes-link" href="#" target="_blank">GoodNotes</a></p>
            </div>
        </div>

        <div class="container links-outer-container">
            <div id="next-class-container" class="container">
                <h3>Next Class</h3>
                <p><span id="next-class-day"></span> at <span id="next-class-time"></span></p>
            </div>

            <div id="time-remaining-container" class="container">
                <h3>Time Remaining</h3>
                <p class="countdown"><span id="days"></span>d <span id="hours"></span>h <span id="minutes"></span>m <span id="seconds"></span>s</p>
            </div>
        </div>

        <div id="user-not-found" class="container" style="display: none;">
            <p>User not found or invalid email parameter.</p>
        </div>
    </div>

    <div id="schedule-display" class="container schedule-container" style="display: none;">
        <h3>Your Weekly Schedule (Local Time)</h3>
        <div id="weekly-schedule">
            <table class="schedule-table">
                <thead>
                    <tr>
                        <th>Day</th>
                        <th>Time</th>
                    </tr>
                </thead>
                <tbody id="schedule-body">
                    </tbody>
            </table>
        </div>   
    </div>

    <div class="container"> rohitmandal814566@gmail.com</div>

    <script>
      // Schedule data stored in UTC
      const schedule = {
       "alvina@gmail.com": {
        classLink: "https://meet.google.com/xdz-xaob-rdk",
        notesLink: "https://example.com/john-notes",
        weeklyScheduleUTC: [
         { day: "Monday", time: "08:30" }, // Monday 8:30 AM UTC
         { day: "Tuesday", time: "08:30" }, // Tuesday 8:30 AM UTC
         { day: "Wednesday", time: "08:30" }, // Wednesday 8:30 AM UTC
         { day: "Wednesday", time: "08:30" }
        ]
       },
       "alice@example.com": {
        classLink: "https://zoom.us/alice-session",
        notesLink: "https://example.com/alice-notes",
        weeklyScheduleUTC: [
         { day: "Tuesday", time: "09:00" },
         { day: "Friday", time: "12:00" },
         { day: "Tuesday", time: "15:00" }
        ]
       }
      };
    
      // Function to get the user's current local time
      function getCurrentLocalDateTime() {
       return new Date();
      }
    
      // Function to calculate time remaining until the next class (based on UTC schedule)
      function calculateTimeRemaining(userSchedule) {
       const nowLocal = getCurrentLocalDateTime();
       const nowUTC = new Date(nowLocal.getTime() + nowLocal.getTimezoneOffset() * 60000); // Convert local time to UTC
       const dayNames = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"];
       const currentDayUTCIndex = nowUTC.getUTCDay();
       const currentDayUTC = dayNames[currentDayUTCIndex];
    
       let closestFutureTimeUTC = null;
       let closestClassSchedule = null;
    
       for (const item of userSchedule.weeklyScheduleUTC) {
        const [hoursUTC, minutesUTC] = item.time.split(':').map(Number);
        const targetDayIndex = dayNames.indexOf(item.day);
    
        // Calculate the date of the next occurrence of this class
        let nextClassDateUTC = new Date(Date.UTC(
         nowUTC.getUTCFullYear(),
         nowUTC.getUTCMonth(),
         nowUTC.getUTCDate() + (targetDayIndex - currentDayUTCIndex + 7) % 7, // Get days until next occurrence
         hoursUTC,
         minutesUTC,
         0,
         0
        ));
    
        // If it's the same day, ensure the time is in the future
        if (targetDayIndex === currentDayUTCIndex && nextClassDateUTC.getTime() <= nowUTC.getTime()) {
         nextClassDateUTC.setDate(nextClassDateUTC.getUTCDate() + 7); // Move to next week
        }
    
        if (!closestFutureTimeUTC || nextClassDateUTC < closestFutureTimeUTC) {
         closestFutureTimeUTC = nextClassDateUTC.getTime();
         closestClassSchedule = item;
        }
       }
    
       if (!closestClassSchedule) return null;
    
       const timeDiff = closestFutureTimeUTC - nowUTC.getTime();
       const days = Math.floor(timeDiff / (1000 * 60 * 60 * 24));
       const hours = Math.floor((timeDiff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
       const minutes = Math.floor((timeDiff % (1000 * 60 * 60)) / (1000 * 60));
       const seconds = Math.floor((timeDiff % (1000 * 60)) / 1000);
    
       const closestClassTimeViewerLocal = new Date(closestFutureTimeUTC);
    
       return { days, hours, minutes, seconds, closestClassSchedule, closestClassTimeViewerLocal };
      }
    
      // Function to display countdown and update every second
      function updateDisplay(userSchedule) {
       const classLinkElement = document.getElementById("class-link");
       const notesLinkElement = document.getElementById("notes-link");
       const nextClassDayElement = document.getElementById("next-class-day");
       const nextClassTimeElement = document.getElementById("next-class-time");
       const daysElement = document.getElementById("days");
       const hoursElement = document.getElementById("hours");
       const minutesElement = document.getElementById("minutes");
       const secondsElement = document.getElementById("seconds");
       const userNotFoundDiv = document.getElementById("user-not-found");
       const scheduleDisplayDiv = document.getElementById("schedule-display");
       const scheduleBody = document.getElementById("schedule-body");
    
       const timeRemainingData = calculateTimeRemaining(userSchedule);
    
       if (timeRemainingData) {
        const { days, hours, minutes, seconds, closestClassSchedule, closestClassTimeViewerLocal } = timeRemainingData;
    
        classLinkElement.href = userSchedule.classLink;
        notesLinkElement.href = userSchedule.notesLink;
        nextClassDayElement.textContent = closestClassTimeViewerLocal.toLocaleDateString('en-US', { weekday: 'long' });
        nextClassTimeElement.textContent = closestClassTimeViewerLocal.toLocaleTimeString(undefined, { hour: '2-digit', minute: '2-digit' });
        daysElement.textContent = days;
        hoursElement.textContent = hours;
        minutesElement.textContent = minutes;
        secondsElement.textContent = seconds;
        userNotFoundDiv.style.display = 'none';
    
        const totalSecondsRemaining = (days * 24 * 3600) + (hours * 3600) + (minutes * 60) + seconds;
    
        if (totalSecondsRemaining < 600) {
         // window.open(userSchedule.classLink, '_blank');
         // clearInterval(countdownInterval);
        }
       } else {
        nextClassDayElement.textContent = "No";
        nextClassTimeElement.textContent = "upcoming class";
        daysElement.textContent = "0";
        hoursElement.textContent = "0";
        minutesElement.textContent = "0";
        secondsElement.textContent = "0";
        userNotFoundDiv.style.display = 'none';
       }
    
       // Display the weekly schedule in a table in the user's local time zone
       if (userSchedule && userSchedule.weeklyScheduleUTC) {
        scheduleDisplayDiv.style.display = 'block';
        scheduleBody.innerHTML = ''; // Clear previous schedule
    
        const dayNames = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"];
        const nowLocal = getCurrentLocalDateTime();
        const nowUTC = new Date(nowLocal.getTime() + nowLocal.getTimezoneOffset() * 60000);
        const currentDayUTCIndex = nowUTC.getUTCDay();
    
        userSchedule.weeklyScheduleUTC.forEach(item => {
         const row = scheduleBody.insertRow();
         const dayCell = row.insertCell();
         const timeCell = row.insertCell();
    
         const targetDayIndex = dayNames.indexOf(item.day);
         const daysToAdd = (targetDayIndex - currentDayUTCIndex + 7) % 7;
    
         const [hoursUTC, minutesUTC] = item.time.split(':').map(Number);
         const classDateUTC = new Date(Date.UTC(
          nowUTC.getUTCFullYear(),
          nowUTC.getUTCMonth(),
          nowUTC.getUTCDate() + daysToAdd,
          hoursUTC,
          minutesUTC,
          0,
          0
         ));
    
         const localDay = classDateUTC.toLocaleDateString('en-US', { weekday: 'long' });
         const localTime = classDateUTC.toLocaleTimeString(undefined, { hour: '2-digit', minute: '2-digit' });
    
         dayCell.textContent = localDay;
         timeCell.textContent = localTime;
        });
       } else {
        scheduleDisplayDiv.style.display = 'none';
       }
      }
    
      function initialize(email, userSchedule) {
       // Initial display
       updateDisplay(userSchedule);
    
       // Update the display every second to react to potential time/timezone changes
       setInterval(() => {
        updateDisplay(userSchedule);
       }, 1000);
      }
    
      function getEmailFromURL() {
       const urlParams = new URLSearchParams(window.location.search);
       return urlParams.get('email');
      }
    
      const email = getEmailFromURL();
      if (email && schedule[email]) {
       initialize(email, schedule[email]);
      } else {
       document.getElementById("user-info").style.display = 'none';
       document.getElementById("schedule-display").style.display = 'none';
       document.getElementById("user-not-found").style.display = 'block';
      }
     </script>

</body>
</html>
